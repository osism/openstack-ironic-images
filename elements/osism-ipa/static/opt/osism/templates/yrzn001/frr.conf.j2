frr version 8.4.4
frr defaults traditional
hostname osism-ipa
no ipv6 forwarding
service integrated-vtysh-config
!
router bgp {{ osism_as }}
 bgp router-id {{ osism_ipv4 }}
 bgp bestpath as-path multipath-relax
 neighbor switches peer-group
 neighbor switches remote-as external
 neighbor switches password {{ osism_aa }}
 neighbor switches timers connect 30
{% for interface in osism_interfaces %}
 neighbor {{ interface }} interface peer-group switches
{% endfor %}
 !
 address-family ipv4 unicast
  redistribute connected route-map RM-redist-loopback
  no neighbor switches send-community
  neighbor switches route-map RM-switches-in in
  neighbor switches route-map RM-switches-out out
  maximum-paths 2
 exit-address-family
 !
 address-family ipv6 unicast
  redistribute connected route-map RM-redist-loopback
  no neighbor switches send-community
  neighbor switches activate
  neighbor switches route-map RM-switches-in in
  neighbor switches route-map RM-switches-out out
  maximum-paths 2
 exit-address-family

exit
!
route-map RM-redist-loopback permit 100
 match interface loopback0
exit
!
route-map RM-switches-in permit 100
exit
!
route-map RM-switches-out permit 100
 match interface loopback0
exit
!
route-map RM_SET_SRC4 permit 10
 set src {{ osism_ipv4 }}
exit
!
route-map RM_SET_SRC6 permit 10
 set src {{ osism_ipv6 }}
exit
!
ip protocol bgp route-map RM_SET_SRC4
!
ipv6 protocol bgp route-map RM_SET_SRC6
